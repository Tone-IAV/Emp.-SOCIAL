<div class="p-4">
  <h2 class="text-xl font-bold mb-4">üíß Cadastro e Gerenciamento de Po√ßos</h2>

  <!-- FORMUL√ÅRIO DE CADASTRO -->
  <form id="formPoco" class="bg-white rounded-lg shadow p-4 mb-6 space-y-4">
    <div class="grid md:grid-cols-3 gap-3">
      <div><label>Estado</label><input id="estado" class="border p-2 w-full rounded" required></div>
      <div><label>Munic√≠pio</label><input id="municipio" class="border p-2 w-full rounded" required></div>
      <div><label>Comunidade</label><input id="comunidade" class="border p-2 w-full rounded"></div>
    </div>

    <div class="grid md:grid-cols-2 gap-3">
      <div><label>Latitude</label><input id="latitude" class="border p-2 w-full rounded"></div>
      <div><label>Longitude</label><input id="longitude" class="border p-2 w-full rounded"></div>
    </div>

    <div class="grid md:grid-cols-2 gap-3">
      <div><label>Benefici√°rios</label><input id="beneficiarios" type="number" class="border p-2 w-full rounded"></div>
      <div><label>Investimento (R$)</label><input id="investimento" type="number" class="border p-2 w-full rounded"></div>
    </div>

    <div class="grid md:grid-cols-3 gap-3">
      <div><label>Vaz√£o (L/H)</label><input id="vazao" class="border p-2 w-full rounded"></div>
      <div><label>Profundidade (m)</label><input id="profundidade" class="border p-2 w-full rounded"></div>
      <div><label>Status</label>
        <select id="status" class="border p-2 w-full rounded">
          <option>Planejado</option>
          <option>Em execu√ß√£o</option>
          <option>Conclu√≠do</option>
        </select>
      </div>
    </div>

    <div class="grid md:grid-cols-2 gap-3">
      <div><label>Valor Previsto Perfura√ß√£o (R$)</label><input id="valorPerf" type="number" class="border p-2 w-full rounded"></div>
      <div><label>Valor Previsto Instala√ß√£o (R$)</label><input id="valorInst" type="number" class="border p-2 w-full rounded"></div>
    </div>

    <div class="grid md:grid-cols-2 gap-3">
      <div><label>Empresa Respons√°vel</label><input id="empresa" class="border p-2 w-full rounded"></div>
      <div><label>Doador</label><input id="doador" class="border p-2 w-full rounded"></div>
    </div>

    <div class="grid md:grid-cols-3 gap-3">
      <div><label>Respons√°vel interno pelo contato</label><input id="responsavelContato" class="border p-2 w-full rounded"></div>
      <div><label>Contato para instala√ß√£o</label><input id="contatoInstalacao" class="border p-2 w-full rounded"></div>
      <div><label>Telefone / WhatsApp</label><input id="telefoneContato" class="border p-2 w-full rounded"></div>
    </div>

    <div class="grid md:grid-cols-3 gap-3">
      <div>
        <label>Status do contato</label>
        <select id="statusContato" class="border p-2 w-full rounded">
          <option>N√£o iniciado</option>
          <option>Em negocia√ß√£o</option>
          <option>Aguardando resposta</option>
          <option>Confirmado</option>
          <option>Conclu√≠do</option>
        </select>
      </div>
      <div><label>√öltimo contato</label><input id="ultimoContato" type="date" class="border p-2 w-full rounded"></div>
      <div><label>Pr√≥xima a√ß√£o</label><input id="proximaAcao" class="border p-2 w-full rounded" placeholder="Ex.: enviar or√ßamento"></div>
    </div>

    <div>
      <label>Impacto na situa√ß√£o do po√ßo</label>
      <textarea id="impactoNoStatus" rows="2" class="border p-2 w-full rounded" placeholder="Resumo do impacto do contato"></textarea>
    </div>

    <div>
      <label>Observa√ß√µes gerais</label>
      <textarea id="obs" rows="2" class="border p-2 w-full rounded"></textarea>
    </div>

    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
      üíæ Salvar Po√ßo
    </button>
  </form>

  <!-- TABELA -->
  <h3 class="font-semibold mb-2">Po√ßos Cadastrados</h3>
  <div class="overflow-x-auto">
    <table id="tabelaPocos" class="min-w-full bg-white rounded shadow text-sm">
      <thead class="bg-blue-100">
        <tr>
          <th class="p-2 text-left">Munic√≠pio</th>
          <th class="p-2 text-left">Comunidade</th>
          <th class="p-2 text-left">Estado</th>
          <th class="p-2 text-left">Benefici√°rios</th>
          <th class="p-2 text-left">Status</th>
          <th class="p-2 text-left">Respons√°vel</th>
          <th class="p-2 text-left">Contato instala√ß√£o</th>
          <th class="p-2 text-left">Status contato</th>
          <th class="p-2 text-left">Pr√≥xima a√ß√£o</th>
          <th class="p-2 text-left">√öltimo contato</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="mensagem" class="mt-4 text-green-700 font-semibold"></div>
</div>

<script>
document.getElementById('formPoco').addEventListener('submit', e => {
  e.preventDefault();

  const data = {
    estado: estado.value,
    municipio: municipio.value,
    comunidade: comunidade.value,
    latitude: latitude.value,
    longitude: longitude.value,
    beneficiarios: beneficiarios.value,
    investimento: investimento.value,
    vazao: vazao.value,
    profundidade: profundidade.value,
    perfuracao: '', // opcional para preencher depois
    instalacao: '', // idem
    doador: doador.value,
    status: status.value,
    valorPerf: valorPerf.value,
    valorInst: valorInst.value,
    empresa: empresa.value,
    obs: obs.value,
    responsavelContato: responsavelContato.value,
    contatoInstalacao: contatoInstalacao.value,
    telefoneContato: telefoneContato.value,
    statusContato: statusContato.value,
    ultimoContato: ultimoContato.value,
    proximaAcao: proximaAcao.value,
    impactoNoStatus: impactoNoStatus.value
  };

  google.script.run.withSuccessHandler(() => {
    mensagem.textContent = "‚úÖ Po√ßo salvo com sucesso!";
    e.target.reset();
    carregarPocos();
  }).salvarPoco(data);
});

function carregarPocos() {
  google.script.run.withSuccessHandler(pocos => {
    const tbody = document.querySelector('#tabelaPocos tbody');
    const formatDate = valor => {
      if (!valor) return '-';
      const data = new Date(valor);
      if (isNaN(data.getTime())) return '-';
      return data.toLocaleDateString('pt-BR');
    };

    tbody.innerHTML = pocos.map(p => `
      <tr class="border-b hover:bg-gray-50">
        <td class="p-2">${p['Munic√≠pio'] || '-'}</td>
        <td class="p-2">${p['Comunidade'] || '-'}</td>
        <td class="p-2">${p['Estado'] || '-'}</td>
        <td class="p-2">${p['Benefici√°rios'] || '-'}</td>
        <td class="p-2">${p['Status'] || '-'}</td>
        <td class="p-2">${p['ResponsavelContato'] || '-'}</td>
        <td class="p-2">${p['ContatoInstalacao'] || '-'}</td>
        <td class="p-2">${p['StatusContato'] || '-'}</td>
        <td class="p-2">${p['ProximaAcao'] || '-'}</td>
        <td class="p-2">${formatDate(p['UltimoContato'])}</td>
      </tr>
    `).join('');
  }).listarPocos();
}
carregarPocos();
</script>
