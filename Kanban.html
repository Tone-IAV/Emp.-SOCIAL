<div class="p-4">
  <h2 class="text-xl font-bold mb-4">ğŸ—‚ï¸ Kanban de Acompanhamento</h2>
  <p class="text-gray-600 mb-4">Arraste os cartÃµes entre colunas para atualizar o status dos poÃ§os.</p>

  <div class="grid md:grid-cols-3 gap-4" id="kanbanBoard">
    <div class="bg-gray-100 rounded-lg p-2">
      <h3 class="font-semibold text-blue-800 mb-2">Planejado</h3>
      <div class="kanban-col min-h-[200px] bg-white p-2 rounded" data-status="Planejado"></div>
    </div>
    <div class="bg-gray-100 rounded-lg p-2">
      <h3 class="font-semibold text-yellow-700 mb-2">Em execuÃ§Ã£o</h3>
      <div class="kanban-col min-h-[200px] bg-white p-2 rounded" data-status="Em execuÃ§Ã£o"></div>
    </div>
    <div class="bg-gray-100 rounded-lg p-2">
      <h3 class="font-semibold text-green-700 mb-2">ConcluÃ­do</h3>
      <div class="kanban-col min-h-[200px] bg-white p-2 rounded" data-status="ConcluÃ­do"></div>
    </div>
  </div>
</div>

<script>
function carregarKanban() {
  google.script.run.withSuccessHandler(pocos => {
    document.querySelectorAll('.kanban-col').forEach(c => c.innerHTML = '');
    pocos.forEach(p => {
      const card = document.createElement('div');
      card.className = 'bg-blue-50 border rounded p-2 mb-2 cursor-grab';
      card.draggable = true;
      card.dataset.id = p.ID;
      card.innerHTML = `
        <strong>${p.Comunidade || p.MunicÃ­pio}</strong><br>
        <small>${p.Base || p.Estado}</small><br>
        <small class="text-gray-500">${p.Status}</small>
      `;
      const col = document.querySelector(`.kanban-col[data-status="${p.Status}"]`);
      if (col) col.appendChild(card);
    });
    configurarDrag();
  }).listarPocos();
}

function configurarDrag() {
  document.querySelectorAll('.kanban-col').forEach(col => {
    col.addEventListener('dragover', e => e.preventDefault());
    col.addEventListener('drop', e => {
      const id = e.dataTransfer.getData('id');
      const status = col.dataset.status;
      const card = document.querySelector(`[data-id="${id}"]`);
      col.appendChild(card);
      google.script.run.atualizarStatusPoco(id, status);
    });
  });

  document.querySelectorAll('.kanban-col div[draggable]').forEach(card => {
    card.addEventListener('dragstart', e => {
      e.dataTransfer.setData('id', card.dataset.id);
    });
  });
}

carregarKanban();
</script>
